<div class="lift:surround?with=unstyledDefaultWebMeTL;at=content">
    <head>
        <link rel="stylesheet" href="static/css/selectize.default.css"></link>
        <link rel="stylesheet" href="static/css/directlyOnBackground.css"></link>
        <link rel="stylesheet" href="static/css/statistics.css"></link>
        <script src="static/js/stable/sprintf-0.7-beta1.js"></script>
        <script src="static/js/stable/lodash.min.js"></script>
        <script src="static/js/stable/moment.min.js"></script>
        <script src="static/js/stable/d3.v4.min.js"></script>
        <script src="static/js/stable/d3.layout.cloud.js"></script>
        <script src="static/js/stable/typo.js"></script>
        <script src="static/js/stable/selectize.min.js"></script>
        <style>
            .result {
                text-align: right;
            }
        </style>
    </head>
    <script type="text/javascript">
        var updateStatistics = function (s) {
            $('#statistics').html(s);
            var now = new Date();
            var t = sprintf("%02d:%02d:%02d", now.getHours(), now.getMinutes(), now.getSeconds());
            $('#timestampStats').html('Last run: ' + t);
        };
        var createTable = function (a) {
            var table = $("<table/>");
            var tr = $("<tr/>");
            table.append(tr);
            _.forEach(a.headers, function (header) {
                tr.append('<th>' + header + '</th>');
            });
            _.forEach(a.data, function (row) {
                tr = $("<tr/>");
                table.append(tr);
                _.forEach(a.headers, function (header) {
                    tr.append('<td>' + row[header] + '</td>');
                });
            });
            return table;
        };
        var updateActivity = function (a) {
            var div = $("<div/>");
            div.append($("<a href='/studentActivity?courseId=" + a.courseId + "'>Download as CSV</a>")).append(createTable(a));
            $('#courseActivity').html(div);
            var now = new Date();
            var t = sprintf("%02d:%02d:%02d", now.getHours(), now.getMinutes(), now.getSeconds());
            $('#timestampActivity').html('Last run: ' + t + '<br/>Results are cached for 1 minute');
        };
/*
        var updateCourses = function (a) {
            var select = $('#courses');
            select.empty();
            _.forEach(a, function (course) {
                tr.append('<option value="' + course.key + '">' + course.name + '</option>');
            });
            select.selectize({maxOptions: 20, closeAfterSelect: true});
            return select;
        };
*/
        var selectize = function () {
            $('#courses').selectize({maxOptions: 20, closeAfterSelect: true});
        };
    </script>
    <div id="masterLayout" class="flex-container-column">
        <div class="mbt">
            <div class="indent flex-container-row">
                <div class="flex-container-column">
                    <h1 class="directlyOnBackground">Enterprise Statistics</h1>
                    <div id="searchBoxContainer" class="mbt indent">
                        <span id="searchBox"></span>
                        <div class="flex-container-row">
                        <span class="lift:statistics">
                            <div class="directlyOnBackground">
                                <span id="statistics"/>
                            </div>
                            <button id="statisticsButton" type="button" value="Search">
                                <span class="fa fa-search">
                                  <span class="icon-txt">Search</span>
                                </span>
                            </button>
                            <span id="timestampStats" class="directlyOnBackground"/>
                            <div id="loaderStats"></div>
                        </span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="indent flex-container-row">
                <div class="flex-container-column">
                    <h1 class="directlyOnBackground">Course Analysis</h1>
                    <div id="selectBoxContainer" class="mbt indent">
                        <span id="selectBox"></span>
                        <div class="flex-container-row">
                        <span class="lift:studentActivity">
                            <div id="courses-container">
                                <label for="courses" class="directlyOnBackground">Select Course:</label>
                                <select id="courses" class="demo-default"></select>
                            </div>
                            <div class="directlyOnBackground">
                                <span id="courseActivity"/>
                            </div>
                            <span id="timestampActivity" class="directlyOnBackground"/>
                            <div id="loaderSelectize"></div>
                        </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
